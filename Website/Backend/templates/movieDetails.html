{% extends "base.html" %}

{% block title %}{{ movie.title }} - Details{% endblock %}

{% block content %}
<div class="container py-5">
  <!-- Movie Detail Section -->
  <section class="card bg-dark text-white shadow-lg mb-5">
    <div class="row g-0">
      <div class="col-md-4">
        <img
          src="{{ url_for('static', filename='images/' ~ movie.image_path) }}"
          alt="Poster for {{ movie.title }}"
          class="img-fluid rounded-start"
          onerror="this.onerror=null;this.src='/static/images/keyboard.jpg';"
        >
      </div>

      <div class="col-md-8">
        <article class="card-body">
          <h2 class="card-title">{{ movie.title }}</h2>
          <ul class="list-unstyled mb-3">
            <li><strong>Release Year:</strong> {{ movie.release_year }}</li>
            <li><strong>Rating:</strong> {{ movie.rating or "Not Rated" }}</li>
            <li><strong>Price:</strong> ${{ "%.2f"|format(movie.price) }}</li>
          </ul>

          {% if genres %}
          <div class="mb-3">
            <strong>Genres:</strong><br>
            {% for genre in genres %}
              <span class="badge bg-primary me-1">{{ genre }}</span>
            {% endfor %}
          </div>
          {% endif %}

          {% if current_user.is_authenticated and current_user.role == 'customer' %}
          <div class="mt-4">
            <button
              class="btn btn-success add-to-cart-btn"
              data-movie-id="{{ movie.movie_id }}"
              data-title="{{ movie.title|e }}"
              data-price="{{ movie.price }}"
              aria-label="Add {{ movie.title }} to cart"
            >
              <i class="fa fa-shopping-cart me-1"></i> Add to Cart
            </button>
          </div>
          {% endif %}

          <!-- Movie Description -->
          <div class="card-body">
            <div class="bg-secondary text-dark p-3 rounded text-center shadow-sm"></div>
            {% if movie.description %}
              <p>{{ movie.description }}</p>
            {% else %}
                No description available.
            </div>
            {% endif %}
          </div>

            </section>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!--  Review Section -->
  <section class="card bg-dark text-white shadow-lg">
    <div class="card-header border-secondary border-bottom">
      <h4 class="mb-0"><i class="fa fa-comments me-2"></i>User Reviews</h4>
    </div>

    <div class="card-body">
      {% if reviews %}
        <div class="list-group">
          {% for r in reviews %}
            <div class="list-group-item list-group-item-dark mb-3 rounded">
              <p class="mb-1"><strong>{{ r.username }}</strong> rated it ‚≠ê {{ r.rating }}</p>
              <p class="mb-1">{{ r.review_comment or "No comment." }}</p>
              <small class="text-muted">{{ r.review_date.strftime('%Y-%m-%d %H:%M') }}</small>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted text-center">No reviews for this movie yet.</p>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}
