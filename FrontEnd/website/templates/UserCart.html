{% extends "base.html" %}

{% block title %}Your Cart - Movie Store{% endblock %}

{% block content %}
<header class="bg-dark py-5">
  <div class="container text-center text-white">
    <h1 class="display-4 fw-bolder">Your Cart</h1>
    <p class="lead fw-normal text-white-50 mb-0">Review your selections</p>
  </div>
</header>

<!-- Cart Section -->
<section class="py-5">
  <div class="container">
    <h3 class="mb-4">Cart Items</h3>
    <ul id="cart-items" class="list-group mb-4">
      <li class="list-group-item text-center">Your cart is empty.</li>
    </ul>

    <div class="d-flex justify-content-between">
      <h4>Total Items: <span id="total-items">0</span></h4>
      <h4>Total Price: $<span id="total-price">0.00</span></h4>
    </div>

    <div class="mt-3 d-flex justify-content-between">
      <button id="clear-cart-btn" class="btn btn-danger">Clear Cart</button>
      <button id="checkout-btn" class="btn btn-success">Proceed to Checkout</button>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<!-- Load external cart.js file -->
<script src="{{ url_for('static', filename='js/cart.js') }}" defer></script>
<script defer>
document.addEventListener("DOMContentLoaded", () => {
  console.log("Cart page loaded!");

  const checkoutBtn = document.getElementById("checkout-btn");
  const totalItemsEl = document.getElementById("total-items");

  // Ensure the checkout button exists before attaching the event listener
  if (checkoutBtn && totalItemsEl) {
    checkoutBtn.addEventListener("click", () => {
      const totalItems = parseInt(totalItemsEl.innerText, 10);
      if (isNaN(totalItems) || totalItems === 0) {
        alert("Your cart is empty. Please add items before proceeding to checkout.");
        return;
      }
      // Redirect to the checkout page
      window.location.href = "/checkout";
    });
  } else {
    console.error("Checkout button or total items element not found.");
  }
});
</script>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cart.css') }}">
{% endblock %}
